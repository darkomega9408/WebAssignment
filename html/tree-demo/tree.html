<!DOCTYPE html>

<html>
<head>
    <title>Tree Demo</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/tree.css" rel="stylesheet">
    <link href="../../css/member-card.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <script src="../../js/jquery-2.2.1.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/tree.js"></script>
</head>
<body>

<button type="button" id="btn">Click me</button>
<div class="tree">

</div>

<script>
    $(document).ready(function () {

        // Click button trigger event
        $('#btn').click(function () {
            $.ajax({
                url: '../../php/server.php',
                type: 'POST'
            }).done(function (data) {
                // show response
                data = JSON.parse(data);
                createTree(data);
            }).fail(function () {
                alert("Post failed");
            });
        });


        // Load member card html and assign to variable
        var memberCardHtml = "";
        $('.tree').load('../card-demo/membercard-demo.html .membercard', function () {
            var obj = $(this).find('.membercard');
            memberCardHtml = obj.html();
            $(this).html('');
        });


        // Use to create tree html
        // data: server 's response , get from DB
        var createTree = function (data) {
            var nbrNode = data.length;

            // Set width for tree
            $('.tree').css('width',nbrNode*300+'px');

            // Add Root node ( if any )
            if( nbrNode <= 0 ) return;
            else $('.tree').append("<ul><li><div class='membercard panel panel-default' id='_"+ data[0].MemberID +"'>"+memberCardHtml+"</div></li></ul>");

            // Add Child node
            for(i = 1 ; i< nbrNode ; ++i) {
                if( data[i].Level != data[i-1].Level )
                    $('#_'+data[i].FatherID).after("<ul><li><div class='membercard panel panel-default' id='_"+ data[i].MemberID +"'>"+memberCardHtml+"</div></li></ul>");
                else
                    $('#_'+data[i].FatherID+'+ul').append("<li><div class='membercard panel panel-default' id='_"+ data[i].MemberID +"'>"+memberCardHtml+"</div></li>");
            }
        };


    });
</script>

</body>
</html>
